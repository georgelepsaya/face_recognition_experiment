<!doctype html>
<html lang="en">

<head>
  <title>Face recognition</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://unpkg.com/jspsych@7.3.4"></script>

  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-button-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
  <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />

  <style>
    .jspsych-btn {
      font-size: 18px;
      padding: 15px 30px;
      margin: 10px;
      min-width: 100px;
      cursor: pointer;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    #jspsych-image-button-response-stimulus {
      display: block;
      margin: 0 auto;
      max-width: 95%;
    }

    .jspsych-btn:hover {
      background-color: #45a049;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .question-text {
      font-size: 24px;
      margin-bottom: 20px;
      text-align: center;
    }

    .button-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .fixation {
      font-size: 60px;
      text-align: center;
      line-height: 1;
    }

    @media (max-width: 600px) {
      .jspsych-btn {
        font-size: 16px;
        padding: 12px 25px;
        min-width: 80px;
      }

      .question-text {
        font-size: 20px;
      }
    }
  </style>
</head>

<body>
  <script type='text/javascript'>

    // Initialise jsPsych
    var jsPsych = initJsPsych({
      on_finish: function () {
        jsPsych.data.displayData();
      }
    });

    // Create the timeline
    var timeline = [];

    // Preload images
    var preload = {
      type: jsPsychPreload,
      images: ["images/test.jpg"]
    }
    timeline.push(preload);

    // Define welcome message trial
    var welcome = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "<h2>Welcome to the experiment</h2><p>Press the button below to begin.</p>",
      choices: ['Begin']
    };
    timeline.push(welcome);

    // Define instructions trial
    var instructions = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "<div style='max-width: 700px; margin: 0 auto; text-align: center;'>" +
        "<p>In this experiment you will be presented with faces.</p>" +
        "<p>Click <strong>'Yes'</strong> if you recognize the person</p>" +
        "<p>Click <strong>'No'</strong> if you don't recognize the person</p>" +
        "<p>Please respond as quickly and accurately as possible.</p>" +
        "</div>",
      choices: ['Start Experiment'],
      post_trial_gap: 200
    };
    timeline.push(instructions);

    // Define test stimuli: image and correct response
    var test_stimuli = [
      {
        stimulus: "images/control/image_1_mb2_gb2.jpg",
        effects: ["motion_blur_2", "gaussian_blur_2"],
        correct_response: 1
      },
    ]

    // Create fixation trial
    var fixation = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div style="font-size: 60px">+</div>',
      choices: 'NO_KEYS',
      trial_duration: 200,
      data: {
        task: 'fixation'
      }
    }

    // Create test trial
    var test = {
      type: jsPsychImageButtonResponse,
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: ['Yes', 'No'],
      data: {
        task: 'response',
        correct_response: jsPsych.timelineVariable('correct_response')
      },
      on_finish: function(data) {
        data.correct = data.response === data.correct_response;
      }
    }

    // Define the test procedure
    var test_procedure = {
      timeline: [fixation, test],
      timeline_variables: test_stimuli,
      randomize_order: true
    }

    // Add randomized test trials to the timeline
    timeline.push(test_procedure);

    // Create a debrief block
    var debrief_block = {
      type: jsPsychHtmlButtonResponse,
      stimulus: function () {
        var trials = jsPsych.data.get().filter({task: 'response'});
        var correct_trials = trials.filter({correct: true});
        var accuracy = Math.round(correct_trials.count() / trials.count() * 100);

        return `<div style='text-align: center;'>
          <h2>Thank you for participating!</h2>
          <p>You responded correctly on ${accuracy}% of the trials.</p>
          <p>Press the button below to complete the experiment.</p>
          </div>`;
      },
      choices: ['Finish']
    };
    timeline.push(debrief_block);

    /* start the experiment */
    jsPsych.run(timeline);

  </script>
</body>

</html>
